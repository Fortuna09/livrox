<div class="book-details" *ngIf="book" [class.galaxy-background]="hasTrophy">
  <div class="header">
    <button class="back-button" routerLink="/meus-livros">← Voltar</button>
  </div>

  <div class="content">
    <div class="book" [class.trophy-earned]="hasTrophy">
      <img [src]="book.coverImageUrl" [alt]="book.title" class="book-cover" />
      <div class="book-info">
        <div class="info">
          <h1>{{ book.title }}</h1>
          <p class="author">por {{ book.author }}</p>
          <p class="year" *ngIf="book.year">Ano: {{ book.year }}</p>
          <p class="genre" *ngIf="book.genre">Gênero: {{ book.genre }}</p>
        </div>

        <!-- Medalhas conquistadas -->
        <app-book-medals
          *ngIf="hasStartedReading() && (medals.length > 0 || hasTrophy)"
          [medals]="medals"
          [currentProgress]="getProgress()"
          [hasTrophy]="hasTrophy"
          class="book-medals"
        >
        </app-book-medals>
      </div>
    </div>

    <div class="statistics">
      <h2>Estatísticas de Leitura</h2>

      <!-- Estado: Não Iniciado -->
      <app-not-started-card *ngIf="!hasStartedReading()" (startReading)="startReading()">
      </app-not-started-card>

      <!-- Calendário e ações -->
      <app-reading-calendar
        *ngIf="hasStartedReading()"
        [calendarDays]="calendarDays"
        [startDateFormatted]="formatDate(book.startReadingDate!)"
        [maxDate]="getTodayDate()"
        (addActivity)="onManualActivityAdded($event)"
      >
      </app-reading-calendar>

      <!-- Grid de estatísticas -->
      <app-reading-stats
        *ngIf="hasStartedReading()"
        [pagesRead]="book.pagesRead || 0"
        [totalPages]="book.totalPages || 0"
        [progress]="getProgress()"
        [isCompleted]="book.isCompleted || false"
      >
      </app-reading-stats>

      <!-- Painel de Conquistas -->
      <app-achievements
        *ngIf="hasStartedReading() && achievements.length > 0"
        [achievements]="achievements"
      >
      </app-achievements>

      <!-- Ação de cancelar leitura -->
      <div class="cancel-reading-section" *ngIf="hasStartedReading()">
        <button class="btn-cancel-reading" (click)="cancelReading()">Cancelar Leitura</button>
      </div>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!book">
  <p>Carregando...</p>
</div>
