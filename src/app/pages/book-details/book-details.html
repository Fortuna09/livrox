<div class="book-details" *ngIf="book" [class.galaxy-background]="hasTrophy">
  <div class="header">
    <button class="back-button" routerLink="/meus-livros">â† Voltar</button>
  </div>

  <div class="content">
    <div class="book-info" [class.trophy-earned]="hasTrophy">
      <img [src]="book.coverImageUrl" [alt]="book.title" class="book-cover">
      <div class="info">
        <h1>{{ book.title }}</h1>
        <p class="author">por {{ book.author }}</p>
        <p class="year" *ngIf="book.year">Ano: {{ book.year }}</p>
        <p class="genre" *ngIf="book.genre">GÃªnero: {{ book.genre }}</p>
        
        <!-- Medalhas conquistadas -->
        <app-book-medals
          *ngIf="hasStartedReading() && (medals.length > 0 || hasTrophy)"
          [medals]="medals"
          [currentProgress]="getProgress()"
          [hasTrophy]="hasTrophy">
        </app-book-medals>
      </div>
    </div>

    <div class="statistics">
      <h2>EstatÃ­sticas de Leitura</h2>
      
      <!-- Estado: NÃ£o Iniciado -->
      <app-not-started-card 
        *ngIf="!hasStartedReading()"
        (startReading)="startReading()">
      </app-not-started-card>      

      <!-- CalendÃ¡rio e aÃ§Ãµes -->
      <app-reading-calendar
        *ngIf="hasStartedReading()"
        [calendarDays]="calendarDays"
        [startDateFormatted]="formatDate(book.startReadingDate!)"
        [maxDate]="getTodayDate()"
        (addActivity)="onManualActivityAdded($event)">
      </app-reading-calendar>

      <!-- Grid de estatÃ­sticas -->
      <app-reading-stats
        *ngIf="hasStartedReading()"
        [pagesRead]="book.pagesRead || 0"
        [totalPages]="book.totalPages || 0"
        [progress]="getProgress()"
        [isCompleted]="book.isCompleted || false">
      </app-reading-stats>

      <!-- Painel de Conquistas -->
      <app-achievements
        *ngIf="hasStartedReading() && achievements.length > 0"
        [achievements]="achievements">
      </app-achievements>

      <!-- AÃ§Ã£o de cancelar leitura -->
      <div class="cancel-reading-section" *ngIf="hasStartedReading()">
        <button class="btn-cancel-reading" (click)="cancelReading()">
          ğŸš« Cancelar Leitura
        </button>
      </div>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!book">
  <p>Carregando...</p>
</div>
